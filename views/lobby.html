<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="lobby-style.css" />
    <title>Lobby</title>
  </head>

  <body>
    <form action="/lobby" method="POST">
        <nav>
            <ul>
                <li id="main_section"><a href="#main">Main</a></li>
                <li id="cards_section"><a href="#cards">Cards</a></li>
                <li id="store_section"><a href="#store">Store</a></li>
                <li id="rules_section"><a href="#rules">Rules</a></li>
                <li id="profile_section">
                    <a href="#profile">
                        <img id="profile_picture" src="" alt="Profile Picture" />
                    </a>
                </li>
            </ul>
        </nav>

        <div class="content">
            <div id="main" class="main active">
                <h2>Hi there, <span id="main_login_txt"></span>!</h2>
            </div>
            <div id="cards" class="cards">
                <div id="card-container"></div>
            </div>
            <div id="store" class="store">
                <h2>Store</h2>
                <p>This is the store section.</p>
            </div>
            <div id="rules" class="rules">
                <h2>Rules</h2>
                <p>This is the rules section.</p>
            </div>
            <div id="profile" class="profile">
                <h2>Profile</h2>
                <p>Your login: <span id="profile_login_txt"></span></p>
                <p>Your email: <span id="email_txt"></span></p>
                <p>Number of your coins: <span id="coins_number_txt"></span></p>
                <p>You won <span id="wins_number_txt"></span> time(s)!</p>
                <p>You lost <span id="losses_number_txt"></span> time(s)!</p>
                <a href="#log_out">
                    <button onclick="onLogout(event)">Log out</button>
                </a>
            </div>
        </div>
    </form>

    <script>
        function loadCardContent() {
                let cardContainer = document.getElementById("card-container");
                let cardFrame = document.createElement("iframe");
                cardFrame.src = "/card.html";
                cardFrame.style.width = "100%";
                cardFrame.style.height = "100%";
                cardContainer.appendChild(cardFrame);
            }

        loadCardContent();


        function onLogout(ev) {
            ev.preventDefault();

            let req = new XMLHttpRequest();

            req.open("POST", `/lobby/logout`, true);
            req.setRequestHeader("Content-Type", "application/json");
            req.addEventListener("load", () => {
                if (req.status == 200) window.location.href = "/";
            });
            req.send();
        }


        let userDetailsReq = new XMLHttpRequest();

        userDetailsReq.open("GET", `/game-api/account-info`, true);
        userDetailsReq.setRequestHeader("Content-Type", "application/json");
        userDetailsReq.addEventListener("load", () => {
            if (userDetailsReq.status === 200) {
                const resJSON = JSON.parse(userDetailsReq.responseText);

                const profilePicture = resJSON[0].user_picture;
                const profilePictureElement = document.getElementById("profile_picture");
                profilePictureElement.src = `/assets/profile-image/${profilePicture}`;

                const login = resJSON[0].user_login;
                const email = resJSON[0].user_email;
                const coins = resJSON[0].user_coins;
                const wins = resJSON[0].user_wins;
                const losses = resJSON[0].user_losses;

                document.getElementById("main_login_txt").innerText = login;
                document.getElementById("profile_login_txt").innerText = login;
                document.getElementById("email_txt").innerText = email;
                document.getElementById("coins_number_txt").innerText = coins;
                document.getElementById("wins_number_txt").innerText = wins;
                document.getElementById("losses_number_txt").innerText = losses;
            }
        });

        userDetailsReq.send();


        const menuItems = document.querySelectorAll('nav a');
        const contentSections = document.querySelectorAll('.content > div');

        menuItems.forEach((menuItem) => {
            menuItem.addEventListener('click', (e) => {
                e.preventDefault();

                const targetId = e.currentTarget.getAttribute('href').substring(1);

                contentSections.forEach((section) => {
                    section.classList.remove('active');
                });

                document.getElementById(targetId).classList.add('active');
            });
        });


        // let playerCardsReq = new XMLHttpRequest();

        // playerCardsReq.open("GET", `/game-api/player-cards`, true);
        // playerCardsReq.setRequestHeader("Content-Type", "application/json");
        // playerCardsReq.addEventListener("load", () => {
        //     if (playerCardsReq.status === 200) {
        //         const resJSON = JSON.parse(playerCardsReq.responseText);

        //         const cardPicture = resJSON[0].card_picture;
        //         const cardPictureElement = document.getElementById("card_picture");
        //         cardPictureElement.src = `/assets/characters/${cardPicture}`;

        //         const cardName = resJSON[0].card_name;
        //         const cardClass = resJSON[0].card_class;
        //         const cardAttack = resJSON[0].card_attack;
        //         const cardDefence = resJSON[0].card_defence;
        //         const cardHealth = resJSON[0].card_health;
        //         const cardUsagePrice = resJSON[0].card_usage_price;
        //         const cardPrice = resJSON[0].card_price;

        //         document.getElementById("card_name_txt").innerText = cardName;
        //         document.getElementById("card_class_txt").innerText = cardClass;
        //         document.getElementById("card_attack_txt").innerText = cardAttack;
        //         document.getElementById("card_defence_txt").innerText = cardDefence;
        //         document.getElementById("card_health_txt").innerText = cardHealth;
        //         document.getElementById("card_usage_price_txt").innerText = cardUsagePrice;
        //         document.getElementById("card_price_txt").innerText = cardPrice;
        //     }
        // });

        // playerCardsReq.send();
    </script>
  </body>
</html>